import{d as N}from"./player.DQDFRdEJ.js";import{$ as d}from"./store.zaMV-uxg.js";const g=s=>{s.classList.add("hidden"),s.classList.remove("flex")},v=s=>{s.classList.add("flex"),s.classList.remove("hidden")},I="!bg-blue-hover",S=document.querySelectorAll(".playAnnotation"),A=[];for(let s=0;s<S.length;s++){const o=S[s];if(o.dataset.start&&o.dataset.playerId){const n=o.closest(".annotationNode");A.push({start:Math.floor(Number(o.dataset.start)),end:Math.floor(Number(o.dataset.end))>Math.floor(Number(o.dataset.start))?Math.floor(Number(o.dataset.end)):void 0,playerId:o.dataset.playerId,uuid:n.dataset.uuid}),d.setKey(o.dataset.playerId,{...d.get()[o.dataset.playerId]||N,annotationStarts:A}),o.addEventListener("click",()=>{const i=o.dataset.playerId||"null",e=o.dataset.file;d.setKey(i,{...d.get()[i]||N,position:Number(o.dataset.start),seekTo:Number(o.dataset.start),isPlaying:e})})}}d.listen((s,o,n)=>{if(!n)return null;const i=n.split(".")[0],e=s[i],r=document.querySelector(`.eventContainer[data-player-id="${i}"]`);if(!r)return console.error(`No event container found for ${n}`),null;const p=r.querySelectorAll(".annotationNode"),c=r.querySelectorAll(".annotationTags"),u=e.annotationStarts?.filter(t=>t.playerId===n),f=u?.find((t,a)=>typeof t.end=="number"?t.start<=e.position&&t.end>e.position:a<u.length-1?t.start<=e.position&&u[a+1].start>e.position:t.start<=e.position);if(f){const t=r.querySelector(`.annotationNode[data-uuid="${f.uuid}"]`);if(t){if(e.autoScroll)if(e.isEmbed){const a=document.querySelector(`.videoAnnotationContainer[data-player-id="${n}"]`),l=t.offsetTop;a?a.scroll({top:l-a.clientHeight,behavior:"smooth"}):r.scroll({top:l-r.clientHeight/3,behavior:"smooth"})}else t.scrollIntoView({behavior:"smooth",block:"end"});t.classList.add(I)}for(const a of p)a.dataset.uuid!==f.uuid&&a.classList.remove(I)}if(e.showTags!==o[i]?.showTags)if(e.showTags)for(let t=0;t<c.length;t++)v(c[t]);else for(let t=0;t<c.length;t++)g(c[t]);for(const t of p){const a=t.getAttribute("data-uuid");let l="show";if((!a||!e.filteredAnnotations.includes(a))&&(l="hide"),e.clip){const h=t.getAttribute("data-start"),y=t.getAttribute("data-end");if(h&&y){const m=parseInt(h),b=parseInt(y),T=m>e.clip.start&&m<e.clip.end,w=b>e.clip.start&&b<e.clip.end;(!T||!w)&&(l="hide")}}l==="show"?v(t):g(t)}});
